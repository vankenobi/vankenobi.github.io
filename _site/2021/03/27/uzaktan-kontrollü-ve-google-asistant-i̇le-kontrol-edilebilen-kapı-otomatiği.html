<!DOCTYPE html><html lang="en" > <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166528504-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-166528504-1'); </script><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Rfid Ve Google Asistant İle Açılabilen Kapı Otomatiği" /><meta property="og:locale" content="en_US" /><meta name="description" content="Writting" /><meta property="og:description" content="Writting" /><link rel="canonical" href="http://localhost:4000/2021/03/27/uzaktan-kontroll%C3%BC-ve-google-asistant-i%CC%87le-kontrol-edilebilen-kap%C4%B1-otomati%C4%9Fi" /><meta property="og:url" content="http://localhost:4000/2021/03/27/uzaktan-kontroll%C3%BC-ve-google-asistant-i%CC%87le-kontrol-edilebilen-kap%C4%B1-otomati%C4%9Fi" /><meta property="og:site_name" content="Vankenobi" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-27T14:39:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Rfid Ve Google Asistant İle Açılabilen Kapı Otomatiği" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"description":"Writting","@type":"BlogPosting","headline":"Rfid Ve Google Asistant İle Açılabilen Kapı Otomatiği","dateModified":"2021-03-27T14:39:00+03:00","datePublished":"2021-03-27T14:39:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/03/27/uzaktan-kontroll%C3%BC-ve-google-asistant-i%CC%87le-kontrol-edilebilen-kap%C4%B1-otomati%C4%9Fi"},"url":"http://localhost:4000/2021/03/27/uzaktan-kontroll%C3%BC-ve-google-asistant-i%CC%87le-kontrol-edilebilen-kap%C4%B1-otomati%C4%9Fi","@context":"https://schema.org"}</script><title> Rfid Ve Google Asistant İle Açılabilen Kapı Otomatiği - Vankenobi</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="Vankenobi" href="/atom.xml"><link rel="alternate" type="application/json" title="Vankenobi" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.youtube-wrapper{position:relative;width:100%;height:0;padding-bottom:56.25%}.youtube-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}*,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.youtube-wrapper{position:relative;width:100%;height:0;padding-bottom:56.25%}.youtube-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}</style></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">Vankenobi</h1>--><nav role="navigation"><ul><li><a href="/" >Writing</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li><li><a href="/atom.xml" >Rss</a></li><div class="row text-left mt-2"><div class="col"> <a target="_blank" href="https://github.com/vankenobi"><i class="fa fa-github " style="font-size:18px"></i></a> <a target="_blank" href="https://www.linkedin.com/in/musakucuk/"><i class="fa fa-linkedin" style="font-size:18px"></i></a> <a target="_blank" href="mailto:musakucuk99@gmail.com"><i class="fa fa-envelope" style="font-size:18px"></i></a> <a target="_blank" href="https://www.thingiverse.com/vankenobi/designs"><img src="/icon/thingiverse.png" alt="thingiverse"></a></div></div></ul></nav></header><section class="post"><h2>Rfid Ve Google Asistant İle Açılabilen Kapı Otomatiği</h2><p><img src="https://drive.google.com/uc?id=1xHLijZcZAthUZLFhfuBar0_oeQHLvsBL" alt="Tittle-Photo" /></p><h1 id="proje-hakkında">Proje Hakkında</h1><p>Herkese merhabalar, bu blog yazısında Google asistan, rfid kart(anahtarlık), Blynk üzerinden açılabilen aynı zamanda google tablolar üzerinde kimin giriş yaptığını ve ne zaman girdiğini log tutabilen kapı otomatiği projesinden bahsedeceğim.</p><h4 id="proje-gereksinimleri">Proje Gereksinimleri</h4><ul><li>RC522 RFID NFC modülü</li><li>NodeMCU geliştirme kartı</li><li>Yeşil, sarı, kırmızı (3 adet) 5mm led</li><li>1 adet buton</li><li>1 adet 220V röle</li><li>LM2596 ayarlanabilir voltaj düşürücü</li><li>2 Pin yeşil klemens</li><li>Delikli pertinaks</li><li><a href="https://www.thingiverse.com/thing:4808529" target="_blank">3D printerdan çıkarılması gereken STL dosyaları</a></li></ul><h4 id="projede-kullanılan-platformlar">Projede Kullanılan Platformlar</h4><ul><li><a href="https://ifttt.com/" target="_blank">IFTTT</a></li><li><a href="https://blynk.io/" target="_blank">Blynk</a></li><li><a href="https://www.google.com/sheets/about/" target="_blank">Google Sheet</a></li></ul><h1 id="1-adım-proje-i̇çin-blynk-kurulumu">1. Adım Proje İçin Blynk Kurulumu</h1><h4 id="blynk-nedir-">Blynk Nedir ?</h4><p>Blynk nesnelerin interneti için tasarlanmış bir IOT platformudur. Donanımı uzaktan kontrol edebilir,donanıma bağlı sensörlerden gelen veriyi okuyabilir, verileri depolayabilir, görselleştirebilir ve diğer birçok şeyi yapabilen bir IOT platformudur.</p><h4 id="blynk-kurulumu-">Blynk Kurulumu ?</h4><p>Google Play Store üzerinden Blynk uygulamasını android cihazınıza <a href="https://play.google.com/store/apps/details?id=cc.blynk&amp;hl=tr">bu linkten</a> ulaşarak kurabilirsiniz. Cihazınıza kurduktan sonra bir blynk hesabı oluşturmalısınız. Hesap oluşturduktan sonra “New Project” butonuna tıklayarak yeni bir proje oluşturmalısınız.</p><p><img src="https://drive.google.com/uc?id=1SGSmGWn1AgqbUdxsJi8LUmAtFHZQ8fiN" alt="Blynk Google Play" /></p><table><thead><tr><th style="text-align: center">“New Project” butonuna tıkliyoruz</th><th style="text-align: center">Proje adı, kartı ve bağlantı tipini seçerek “create” butonuna tıklıyoruz butona tıkladığınız anda kod içerisinde kullanacağımız auth kodu emailinize gönderilecek.</th></tr></thead><tbody><tr><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xeOLmsgKh12LBAX_sXz6e-fiD6r8TSP8" alt="New Project" /></td><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xV83gX9S5CM69jvV2zPhj5L-ez34CA02" alt="New Project Ayarları" /></td></tr></tbody></table><p><br /></p><table><thead><tr><th style="text-align: center">Widget kutusundan bir button ekliyoruz</th><th style="text-align: center">Eklenen butonun pinini bir sanal pin olan V2 olarak değiştiriyoruz</th></tr></thead><tbody><tr><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xlu-KwwMM17ob2y_DbUzFxnK6zsWlyGI" alt="Button" /></td><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xhAAgSCMZNqoEnDWMeSvg0m6eD5ZBe54" alt="Button Ayarları" /></td></tr></tbody></table><p><br /></p><table><thead><tr><th style="text-align: center">Widget kutusundan bir notification ekliyoruz</th><th style="text-align: center">Eklenen notification widget’ın ayarları</th></tr></thead><tbody><tr><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xgV8GeeIrfvCDjl0rTl9BZbxcfxCe9kn" alt="Button" /></td><td style="text-align: center"><img src="https://drive.google.com/uc?export=view&amp;id=1xgtCliMMW6ngqb3uLnj_9TEh7MnOpY3U" alt="Button Ayarları" /></td></tr></tbody></table><p><br /></p><h5 id="eklenen-widgetlar-sonrası-blynk-paneli-genel-görünümü">Eklenen widgetlar sonrası blynk paneli genel görünümü</h5><p><img src="https://drive.google.com/uc?export=view&amp;id=1y10caqjzqgRAtYqLVmAMviwtJG_KtK0L" alt="New Project" /></p><p><br /></p><h1 id="2-adım-proje-i̇çin-ifttt-google-assistant-kurulumu">2. Adım Proje İçin IFTTT (Google Assistant) Kurulumu</h1><h4 id="ifttt-nedir-">IFTTT Nedir ?</h4><p>IFTTT “If This, Then That” anlamına gelir. IFTTT hem bir websitesidir hem de bir mobil uygulamaya sahiptir. Platformun sağladığı şey uygulamaları birbirine bağlamak. Kısacası servislerin ve cihazların birbirleri ile konuşması diyebiliriz. Örneğin android telefonunuzda bir arama yaparsanız, o aramanın günlüğü bir Google e-tablosuna eklenir. Bunu IfTT size sağlar. Veya evde telefonunuzu kaybettiğiniz zaman google home mini cihazınıza “Benim telefonum nerede ?” sorusunu iletirseniz telefonunuzu çaldıracaktır. Bir başka örnek ise toplantı saatiniz geldiğinde philips hue ampüllerinizi yeşil renkte yakabilirsiniz. Bu ve bunun gibi senaryoları IFTTT ile yapmanız mümkün.</p><p>Ben bu projede evinizdeki google home mini cihazına veya telefonunuzdaki google asistanınıza “hey google open the door” dediğinizde dış kapı otomatiğini tetiklettirmesini öğreteceğim.</p><h4 id="ifttt-google-assistant-applet-kurulumu-">IFTTT (Google assistant Applet) Kurulumu ?</h4><p>IFTTT web sitesine <a href="https://ifttt.com/">buradan</a> ulaşabilirsiniz. Siteye google hesabınızla kayıt olup giriş yaptıktan sonra sırasıyla aşağıdaki adımları izleyerek google asistan ile oluşturduğumuz sisteme komut gönderip kapyı açtırabiliriz.</p><p><strong>İlk olarak IFTTT sitesinde ana sayfada iken sağ üst köşedeki “Create” butonuna tıklıyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1iLJ4JJd7-m1fLEu8Y1wJM15RXsZlJXZF" alt="IFTTT Create" /></p><p><br /></p><p><strong>Gelen sayfada if kutucuğu içerisindeki “add” butonuna tıklıyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1B8G0RTALe21FgpL3oJmEuasAai2cAXGc" alt="IFTTT IF THIS THAN THAT" /></p><p><br /></p><p><strong>Ekrana gelen servisler içerisinden google assistant seçeneğini seçiyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1tg7RbTajvHXVjf-WGprBpYe6847GIqdh" alt="Google Assistant" /></p><p><br /></p><p><strong>Bu kısımda olayın tetiklenmesi için google asistanınıza ne söylemek istediğinizi ve asistanınızın size dönüş olarak ne cevap vereceğini belirliyorsunuz. Create Trigger butonuna basıp tetikleyiciyi oluşturmuş oluyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1cTxWRGKWHt1BWMtlnqw2s9fN_3S_P6XQ" alt="google asistant ayarlar" /></p><p><br /></p><p><strong>Gelen sayfada then that kutucuğu içerisindeki “add” butonuna tıklıyoruz ve servisler arasından webhooks’u seçiyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1jpKy1QGhKs6HmuK5v5cCx6XrOQV3cPt1" alt="google asistant ayarlar" /></p><p><br /></p><p><strong>“authcode” yazan kısma blynk’in kayıt olunan mail adresine gönderdiği auth kodunu yapıştırıyoruz ve diğer ayarları bu şekilde değiştiriyoruz. Create action butonuna basıyoruz</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1pNMt2I5e3UAf8mZKxlS6TuFrKEVl1J6y" alt="google asistant ayarlar" /></p><p><br /></p><h1 id="2-adım-proje-i̇çin-ifttt-google-sheets-applet-kurulumu">2. Adım Proje İçin IFTTT (Google Sheets Applet) Kurulumu</h1><h4 id="ifttt-google-sheets-applet-kurulumu-">IFTTT (Google Sheets Applet) Kurulumu ?</h4><p>Her giren kullanıcı için okuttuğu rfid kartın id’si, giriş yaptığı zaman, adı soyadı ve açılıp açılmadığı bilgilerini göndermek için google tablolarda kayıt tutuyoruz. Google sheet appletlerini eklemek için sırasıyla aşağıdaki adımları izlememiz gerekiyor. Tekrar ana sayfada “create” tuşuna bastıktan ve if kutucuğu içerisindeki “add” butonuna bastıktan sonra servisler içerisinden webhook servisini seçiyoruz.</p><p><strong>event name kısmına logger yazıyorum bu benim yazdığım programın bir gereği siz başka bir şey yazabilirsiniz. create trigger butonuna tıkladıktan sonra then kutucuğunun içerisindeki add butonuna tıklıyoruz ve tekrardan yeni bir servis arıyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1i8Gb5ZHZktLfCakpXfq7BvEFNx8HvWAR" alt="google asistant ayarlar" /></p><p><br /></p><p><strong>Google sheets servisini arıyoruz ve seçiyoruz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1jHGeHfhtW_ecD_TgvVwF99dPzqlFIO0C" alt="google asistant ayarlar" /></p><p><br /></p><p><strong>Daha sonra add row to spreadsheet seçeneğine tıklıyoruz. Bunu seçmemizin sebebi tabloya her yeni bir bilgi geldiğinde yeni bir satıra ekleniyor.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1CnbDMIM9bwLpFpeo8HDDd8WhYBOnJyEa" alt="google asistant ayarlar" /></p><p><br /></p><p><strong>Ayarlar aşağıdaki gibi olmalıdır eğer isterseniz tablo adını değiştirebilirsiniz.</strong> <img src="https://drive.google.com/uc?export=view&amp;id=1zQlM7q6lLmZfqfHNvF38NUgc3yuhNDs1" alt="google asistant ayarlar" /></p><p><br /></p><h2 id="proje-fritzing-şeması">Proje Fritzing Şeması</h2><p><img src="https://drive.google.com/uc?export=view&amp;id=1Fkml9wqiZ7cEA1TqU5v_uhlK3bOEZdzJ" alt="google asistant ayarlar" /></p><p><br /></p><h2 id="proje-kaynak-kodları">Proje Kaynak Kodları</h2><pre><code class="language-c">
#include &lt;SPI.h&gt;    // Rfid modülünün haberleşmesi için SPI kütüphanesi eklendi.
#include &lt;MFRC522.h&gt;  // Rfid modülü için MFRC522 kütüphanesi eklendi.

#include &lt;WiFiClient.h&gt; 
#define BLYNK_PRINT Serial
#include &lt;ESP8266WiFi.h&gt;
#include &lt;BlynkSimpleEsp8266.h&gt;

//***** KABLOSUZ AYARLARI ******* 
char auth[] = "Blynk auth code";    //Blynk auth code girilecek
const char* ssid = "Wifi SSID";     //Bağlanılacak olan wifi ağı adı
const char* pass = "Wifi Pass";     //Bağlanılacak olan wifi ağı şifresi


//************* IFTTT ****************
const char* server = "maker.ifttt.com"; 
// Kişiye özel IFTTT Url'i
const char* resource = "Google Sheet appletinden gelen link";  // Google Sheet appletinde bulunan link

//*********** RFID **************
#define RST_PIN         D8           
#define SS_PIN          D4          
#define relay           D3
#define button          D8

MFRC522 mfrc522(SS_PIN, RST_PIN);   
String readCardId = ""; // okunan kart idsi
String tempid = "";     // değişken kart idsi

//******** Led Pins and Button Pin *************
#define green           D1
#define red             D0
#define yellow          D2

unsigned long lastTime = 0;
unsigned long lastTime1 = 0;
unsigned long lastTime2 = 0;

unsigned long delayTime = 10000; 
unsigned long delayTime1 = 2500;  
unsigned long delayTime2 = 60000;

WiFiClient client;

//***** ANAHTAR LİSTESİ ***********
String Key_list[2][2] =          // Anahtar Listesi
  {
  {"örnek kullanıcı adı1","örnek kullanıcı 1 kartid"},
  {"örnek kullanıcı adı2","örnek kullanıcı 2 kartid"},
  

  };

// Google tablolar ile bağlantı sağlayan fonksiyon 
void connectGoogleSheets()
{
  int retries = 8;

  while(!!!client.connect(server, 80) &amp;&amp; (retries-- &gt; 0)) {
    Serial.print(".");
  }
} 
// IFTTT web servisine bir http isteği gönderir.
void makeIFTTTRequest(String name_surname,String kart_id,String durum) {
  digitalWrite(red,HIGH);
  Serial.print("Connecting to "); 
  Serial.print(server);
  
  int retries = 5;
  while(!!!client.connect(server, 80) &amp;&amp; (retries-- &gt; 0)) {
    Serial.print(".");
  }
  Serial.println();
  if(!!!client.connected()) {
    Serial.println("Failed to connect...");
  }
  
  Serial.print("Request resource: "); 
  Serial.println(resource);

  
  String jsonObject = String("{\"value1\":\"") + name_surname + "\",\"value2\":\"" + kart_id
                      + "\",\"value3\":\"" + durum + "\"}";
                      
            
  client.println(String("POST ") + resource + " HTTP/1.1");
  client.println(String("Host: ") + server); 
  client.println("Connection: close\r\nContent-Type: application/json");
  client.print("Content-Length: ");
  client.println(jsonObject.length());
  client.println();
  client.println(jsonObject);
        
  int timeout = 5 * 10; // 5 seconds             
  while(!!!client.available() &amp;&amp; (timeout-- &gt; 0)){
    delay(100);
  }
  if(!!!client.available()) {
    Serial.println("No response...");
  }
  while(client.available()){
    Serial.write(client.read());
  }
  
  Serial.println("\nclosing connection");
  client.stop(); 
  digitalWrite(red,LOW);
}
String getID()  
{
  digitalWrite(green,HIGH);
  delay(200);
  readCardId = "";
  if(!mfrc522.PICC_IsNewCardPresent())
    {
      return "";
    }
    if(!mfrc522.PICC_ReadCardSerial())
    {
      return "";
    }
    for(int i = 0; i &lt; mfrc522.uid.size;i++)
    {
      readCardId += String(mfrc522.uid.uidByte[i],HEX);
    }
    Serial.println(readCardId);
    digitalWrite(green,LOW);
    return readCardId;
}

void openDoor()   // Kapı aç metodu kapı otomatiğini 200 milisaniye açıyor ve kapatıyor.
{
  digitalWrite(relay,HIGH);
  delay(200);
  digitalWrite(relay,LOW);
}

void decision()   //Karar fonksiyonu ile gelen kart id'nin kararı verilir.
{
  
  for(int count=0;count&lt;11;count++)
    {
      if(Key_list[count][1] == tempid)
      {
        digitalWrite(red,HIGH);
        digitalWrite(green,LOW);
        
        Serial.print(Key_list[count][0]);
       // Serial.println(" Adli kisi giris yapti.");
        openDoor();
        if(Blynk.connected()) makeIFTTTRequest(Key_list[count][0],Key_list[count][1],"Açıldı.");
        
        digitalWrite(red,LOW);
        digitalWrite(green,HIGH);
        tempid = "";
        break;
      }
    }
     if(tempid != "")
      {
        if(Blynk.connected()) makeIFTTTRequest("Bilinmeyen Kullanici",tempid,"Açılmadı.");
        digitalWrite(red,HIGH);
        delay(250);
        digitalWrite(red,LOW);
      }
}

BLYNK_WRITE(V2) // Blynk Write(v2) ile ikinci sanal pinden okuma alınır.Alınan okuma 1 ise kapı açma izni verilir.
{
  digitalWrite(green,LOW);
  int pinData = param.asInt(); 
  if(pinData == 1){
    openDoor();
    makeIFTTTRequest("Google Asistan","Kartız","Açıldı.");
  }
  digitalWrite(green,HIGH);
}

void setup() {
  Serial.begin(9600);  // Seri haberleşmeyi başlatıyoruz.                                         
  SPI.begin();         // Spi haberleşme başlatıldı.                                       
  mfrc522.PCD_Init();  // Rfid modül başlatıldı.
  
  // röle,ledler,ve buton için giriş çıkış atandı.
  pinMode(relay,OUTPUT);
  pinMode(green,OUTPUT);
  pinMode(red,OUTPUT);
  pinMode(yellow,OUTPUT);
  pinMode(button,INPUT);
  digitalWrite(relay,LOW);
  
  Blynk.config(auth,"blynk-cloud.com", 8080);
  
}

void loop() {
  unsigned long nowTime = millis(); 
  unsigned long nowTime1 = millis();
  unsigned long nowTime2 = millis();

  if (nowTime - lastTime &gt;= delayTime) 
  {
    lastTime = nowTime;    
    if(WiFi.status() != WL_CONNECTED) // her 10 saniyede bir internet bağlantısı kontrol edilir eğer bağlantı yok ise tekrar bağlanmayı dener. 
    {
      digitalWrite(yellow,LOW);
      WiFi.begin(ssid,pass);
      Blynk.config(auth,"blynk-cloud.com", 8080);
    } 
    else digitalWrite(yellow,HIGH);
  }

  if(nowTime1 - lastTime1 &gt;= delayTime1) // her 2,5 saniyede bir kapı açma isteği butonuna basılıp basılmadığı kontrol ediliyor.
  {
    lastTime1 = nowTime1;
    if(digitalRead(button) == true){
      digitalWrite(red,HIGH);
      Blynk.notify("Bina içersindeki kapıdan bir kişi kapı açma isteği gönderdi."); 
    }
    else digitalWrite(red,LOW);
  }

  if(nowTime2 - lastTime2 &gt;= delayTime2)  // bir dakikada bir google tablolar ile bağlantı sağlanıyor.
  {
    lastTime2 = nowTime2;
    connectGoogleSheets();
  }
 
  tempid = getID(); //kart üzerinde okunan kart id tempid değişkenine atılır.
  decision();  // karar metodu ile kapının açılıp açılmayacağı kararı verilir.

  Blynk.run();
}

</code></pre><p><br /></p><h2 id="sonuç">Sonuç</h2><div class="youtube-wrapper"> <iframe src="https://www.youtube.com/embed/S1oL-IkkozY" allowfullscreen=""></iframe></div><p><br /></p><span class="meta"><time datetime="2021-03-27T14:39:00+03:00">March 27, 2021</time> &middot; </span></section></main></body></html>
